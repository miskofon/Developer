<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - geometry - cube</title>
		<meta charset="utf-8">
		<style>
			body {
				margin: 0px;
				background-color: #000000;
				overflow: hidden;
			}
		</style>
		<script src="js/three.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/jquery-2.1.3.min.js"></script>
	</head>
	<body>
		<script>

			window.engine = new DevEngine() || {};
			function DevEngine() {
				this.walls = [];
				this.interactions = [];
				this.activeIntercation = null;
				this.meshes = [];
				this.floors = [];
				this.renderer = {};
			};

			function SimpleFloor(position, depth, width, color) {
				this.pos = position;
				this.width = width;
				this.depth = depth;
				this.color = color;
				
				this.getMesh = function() {
					var material = new THREE.MeshBasicMaterial({color: this.color});
					var planeMesh = new THREE.Mesh(new THREE.PlaneGeometry(this.width, this.depth), material);
					planeMesh.position.x = this.pos.x;
					planeMesh.position.y = this.pos.y;
					planeMesh.position.z = this.pos.z;
					return planeMesh;
				};
				
			};
			
			function SimpleWall() {
				this.getMesh = function() {
					if (this.mesh == undefined) {
						var sphereMaterial = new THREE.MeshLambertMaterial( {color: 0x00ff00} ); 
						this.mesh = new THREE.Mesh( new THREE.SphereGeometry( 30, 12, 12), sphereMaterial );
					}
					return this.mesh;
				};
			};
			
			function SimpleInteraction() {
				this.getObjects2Display = function() {
					if (this.wall == undefined) {
						this.wall = new SimpleWall();
					}
					return [this.wall];
				};
			};
					
			DevEngine.prototype.init = function() {
				this.WIDTH = window.innerWidth;
				this.HEIGHT = window.innerHeight;
				
				var container = document.createElement( 'div' );
				document.body.appendChild( container );
				
				this.scene = new THREE.Scene();
				this.renderer = new THREE.WebGLRenderer({antialias:true}); 
				
				this.renderer.setSize( this.WIDTH, this.HEIGHT );
				this.renderer.setClearColor(0xf0f0f0);
				
				this.scene.add( new THREE.AmbientLight( 0x505050 ) );
				
				this.addLight();
				
				this.camera = new THREE.PerspectiveCamera( 50, this.WIDTH / this.HEIGHT, 1, 1000 );
				this.camera.position.x = 0;
				this.camera.position.y = -300;
				this.camera.position.z = 50;
				this.camera.lookAt(this.scene.position);
			
				container.appendChild( this.renderer.domElement );
				
				var that = this;
				window.addEventListener( 'resize', function() { that.onWindowResize();} , false );
			};
			
			DevEngine.prototype.addMeshElement = function(mesh) {
				if ($.inArray(mesh, this.scene.children) == -1) {
						this.scene.add(mesh);
					}
			};
			
			DevEngine.prototype.addFloor = function (floor) {
				this.floors.push(floor);
				this.addMeshElement(floor.getMesh());
			};
			
			DevEngine.prototype.addLight = function() {
				var light = new THREE.SpotLight( 0xffffff, 1.5 );
				light.position.set( 0, 500, 2000 );
				light.castShadow = true;
				
				this.scene.add(light);
			};
			
			DevEngine.prototype.start = function() {
				var that = this;
				requestAnimationFrame(function() { that.animate();} );
				
				var floor = new SimpleFloor(new THREE.Vector3( 0, 0, 0 ), 400, 400, 0x5050FF);
				this.addFloor(floor);
				
				this.activeInteraction = new SimpleInteraction();
				this.interactions.push(this.activeInteraction);
			};

			DevEngine.prototype.animate = function() {

				//do staff
				var that = this;
				if (this.activeInteraction != undefined) {
					var objects = this.activeInteraction.getObjects2Display();
					$.each(objects, function(objectIndex, object) {
						that.addMeshElement(object.getMesh());
					});
				}

				this.renderer.render( this.scene, this.camera );
				requestAnimationFrame(function() { that.animate();} );
			};
			
			DevEngine.prototype.onWindowResize = function () {
				
				DevEngine.camera.aspect = window.innerWidth / window.innerHeight;
				DevEngine.camera.updateProjectionMatrix();

				DevEngine.renderer.setSize( window.innerWidth, window.innerHeight );
			}
			
			
			window.engine.init();
			window.engine.start();

		</script>

	</body>
</html>
